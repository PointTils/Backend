name: Discord PR Notification

on:
  pull_request:
    branches: [dev]
    types: [opened, reopened, ready_for_review, closed]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord notification
          env:
            DISCORD_WEBHOOK: ${{ secrets.DISCORD_PR_WEBHOOK }}
          run: |
            PR_TITLE="${{ github.event.pull_request.title }}"
            PR_URL="${{ github.event.pull_request.html_url }}"
            AUTHOR="${{ github.event.pull_request.user.login }}"
            BRANCH="${{ github.event.pull_request.head.ref }}"
            ACTION="${{ github.event.action }}"
            if [[ "${ACTION}" == "closed" ]]; then
              if [[ "${{ github.event.pull_request.merged }}" == "true" ]]; then
                STATUS="‚úÖ Pull Request mergeado!"
              else
                STATUS="‚ùå Pull Request fechado sem merge!"
              fi
            elif [[ "${ACTION}" == "opened" ]]; then
              STATUS="üöÄ Novo Pull Request aberto!"
            elif [[ "${ACTION}" == "reopened" ]]; then
              STATUS="üîÑ Pull Request reaberto!"
            elif [[ "${ACTION}" == "ready_for_review" ]]; then
              STATUS="üëÄ Pull Request pronto para revis√£o!"
            else
              STATUS="‚ÑπÔ∏è Pull Request atualizado!"
            fi
            MESSAGE="${STATUS}\n\nüîó [${PR_TITLE}](${PR_URL})\nüë§ Autor: ${AUTHOR}\nüåø Branch: ${BRANCH}"
              JSON=$(jq -n --arg content "$MESSAGE" '{content: $content}')
              curl -f -H "Content-Type: application/json" -X POST -d "$JSON" "$DISCORD_WEBHOOK" || { echo "Failed to send Discord notification"; exit 1; }
